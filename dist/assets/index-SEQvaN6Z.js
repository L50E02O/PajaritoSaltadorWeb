(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))h(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&h(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function h(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();class n{constructor(){this.jumpRequested=!1,this.enabled=!1,this.setupEventListeners()}setupEventListeners(){window.addEventListener("keydown",t=>{(t.code==="Space"||t.key===" ")&&(t.preventDefault(),t.target.tagName!=="INPUT"&&t.target.tagName!=="TEXTAREA"&&this.enabled&&(this.jumpRequested=!0))}),window.addEventListener("mousedown",t=>{const e=t.target;e.tagName==="BUTTON"||e.id==="startScreen"||e.id==="gameOverScreen"||e.closest("#startScreen")||e.closest("#gameOverScreen")||this.enabled&&(t.preventDefault(),this.jumpRequested=!0)}),window.addEventListener("touchstart",t=>{const e=t.target;e.tagName==="BUTTON"||e.id==="startScreen"||e.id==="gameOverScreen"||e.closest("#startScreen")||e.closest("#gameOverScreen")||this.enabled&&(t.preventDefault(),this.jumpRequested=!0)}),window.addEventListener("touchmove",t=>{this.enabled&&t.preventDefault()},{passive:!1})}setEnabled(t){this.enabled=t,t||(this.jumpRequested=!1)}consumeJump(){return this.jumpRequested?(this.jumpRequested=!1,!0):!1}reset(){this.jumpRequested=!1}}class o{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.assets={},this.setupCanvas()}setupCanvas(){const h=window.innerWidth,i=window.innerHeight;let a=Math.min(h/400,i/600,1);a=Math.max(a,.5),this.canvas.width=400,this.canvas.height=600,this.canvas.style.width=`${400*a}px`,this.canvas.style.height=`${600*a}px`,this.ctx.scale(1,1)}async loadAssets(t){try{this.assets.bird=await this.createBirdShape(),this.assets.pipe=await this.createPipeShape(),this.assets.background=null}catch(e){console.error("Error cargando assets:",e),this.assets.bird=await this.createBirdShape(),this.assets.pipe=await this.createPipeShape()}}async createBirdShape(){const t=document.createElement("canvas");t.width=40,t.height=30;const e=t.getContext("2d");return e.fillStyle="#FFD700",e.beginPath(),e.arc(20,15,12,0,Math.PI*2),e.fill(),e.fillStyle="#000",e.beginPath(),e.arc(25,12,3,0,Math.PI*2),e.fill(),e.fillStyle="#FF8C00",e.beginPath(),e.moveTo(32,15),e.lineTo(40,12),e.lineTo(40,18),e.closePath(),e.fill(),e.fillStyle="#FFA500",e.beginPath(),e.ellipse(15,20,8,5,-.3,0,Math.PI*2),e.fill(),new Promise(h=>{const i=new Image;i.onload=()=>h(i),i.src=t.toDataURL()})}async createPipeShape(){const t=document.createElement("canvas");t.width=60,t.height=400;const e=t.getContext("2d");return e.fillStyle="#228B22",e.fillRect(0,0,60,400),e.strokeStyle="#006400",e.lineWidth=3,e.strokeRect(0,0,60,400),e.fillStyle="#32CD32",e.fillRect(5,5,50,20),e.fillRect(5,375,50,20),new Promise(h=>{const i=new Image;i.onload=()=>h(i),i.src=t.toDataURL()})}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}drawBackground(){const t=this.ctx.createLinearGradient(0,0,0,this.canvas.height);t.addColorStop(0,"#87CEEB"),t.addColorStop(.5,"#98D8E8"),t.addColorStop(1,"#B0E0E6"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.drawCloud(80,100),this.drawCloud(250,150),this.drawCloud(150,250)}drawCloud(t,e){this.ctx.beginPath(),this.ctx.arc(t,e,20,0,Math.PI*2),this.ctx.arc(t+25,e,25,0,Math.PI*2),this.ctx.arc(t+50,e,20,0,Math.PI*2),this.ctx.fill()}drawBird(t){this.ctx.save(),this.ctx.translate(t.x+t.width/2,t.y+t.height/2),this.ctx.rotate(t.rotation||0),this.ctx.drawImage(this.assets.bird,-t.width/2,-t.height/2,t.width,t.height),this.ctx.restore()}drawPipe(t){this.ctx.drawImage(this.assets.pipe,t.x,t.y,t.width,t.height)}drawPipes(t){t.forEach(e=>{this.drawPipe(e)})}}function c(s,t,e){s.velocity+=t*e,s.y+=s.velocity*e}function d(s,t){s.velocity=-t}function l(s,t){s.velocity>t&&(s.velocity=t)}function p(){const s=localStorage.getItem("pajaritoHighScore");return s?parseInt(s,10):0}function u(s){localStorage.setItem("pajaritoHighScore",s.toString())}function g(s,t){return s.x<t.x+t.width&&s.x+s.width>t.x&&s.y<t.y+t.height&&s.y+s.height>t.y}class f{constructor(){this.canvas=document.getElementById("gameCanvas"),this.renderer=new o(this.canvas),this.input=new n,this.state="start",this.score=0,this.highScore=p(),this.bird={x:100,y:250,width:40,height:30,velocity:0,rotation:0},this.pipes=[],this.pipeWidth=60,this.pipeGap=150,this.pipeSpeed=150,this.gravity=1e3,this.jumpForce=250,this.maxVelocity=400,this.baseGravity=1e3,this.baseJumpForce=250,this.basePipeSpeed=150,this.basePipeGap=150,this.difficultyLevel=0,this.lastTime=0,this.pipeSpawnTimer=0,this.pipeSpawnInterval=1.5,this.init()}async init(){await this.renderer.loadAssets({bird:"./assets/bird.png",pipe:"./assets/pipe.png",background:"./assets/background.png"}),this.setupUI(),this.updateHighScoreDisplay(),this.startGameLoop()}setupUI(){document.getElementById("startButton").addEventListener("click",t=>{t.stopPropagation(),this.startGame()}),document.getElementById("restartButton").addEventListener("click",t=>{t.stopPropagation(),this.startGame()}),document.getElementById("startScreen").addEventListener("click",t=>{t.target.id==="startScreen"||t.target.id==="startButton"||this.startGame()}),window.addEventListener("keydown",t=>{(t.code==="Space"||t.key===" ")&&this.state==="start"&&(t.preventDefault(),this.startGame())})}startGameLoop(){const t=e=>{const h=Math.min((e-this.lastTime)/1e3,.1);this.lastTime=e,this.update(h),this.render(),requestAnimationFrame(t)};requestAnimationFrame(t)}update(t){if(this.state==="playing"){const e=this.input.consumeJump();this.updateBird(t,e),this.updatePipes(t),this.checkCollisions(),this.updateScore()}}updateBird(t,e){e&&d(this.bird,this.jumpForce),c(this.bird,this.gravity,t),l(this.bird,this.maxVelocity),this.bird.rotation=Math.min(this.bird.velocity*.003,Math.PI/2),this.bird.y<0&&(this.bird.y=0,this.bird.velocity=0),this.bird.y+this.bird.height>this.canvas.height&&(this.bird.y=this.canvas.height-this.bird.height,this.gameOver())}updatePipes(t){this.pipes.forEach(e=>{e.x-=this.pipeSpeed*t}),this.pipes=this.pipes.filter(e=>e.x+e.width>-100),this.pipeSpawnTimer+=t,this.pipeSpawnTimer>=this.pipeSpawnInterval&&(this.spawnPipe(),this.pipeSpawnTimer=0)}spawnPipe(){const t=Math.random()*(this.canvas.height-this.pipeGap-200)+100;this.pipes.push({x:this.canvas.width,y:0,width:this.pipeWidth,height:t,passed:!1}),this.pipes.push({x:this.canvas.width,y:t+this.pipeGap,width:this.pipeWidth,height:this.canvas.height-(t+this.pipeGap),passed:!1})}checkCollisions(){const t={x:this.bird.x,y:this.bird.y,width:this.bird.width,height:this.bird.height};for(const e of this.pipes){const h={x:e.x,y:e.y,width:e.width,height:e.height};if(g(t,h)){this.gameOver();return}}}updateScore(){this.pipes.forEach(t=>{if(!t.passed&&t.x+t.width<this.bird.x&&(t.passed=!0,this.pipes.filter(e=>e.passed&&Math.abs(e.x-t.x)<10).length===2)){this.score,this.score++,this.updateScoreDisplay();const e=Math.floor(this.score/25);e>this.difficultyLevel&&(this.difficultyLevel=e,this.increaseDifficulty())}})}increaseDifficulty(){this.pipeSpeed=this.basePipeSpeed+this.difficultyLevel*30,this.pipeGap=Math.max(100,this.basePipeGap-this.difficultyLevel*10),this.gravity=this.baseGravity+this.difficultyLevel*50,this.pipeSpawnInterval=Math.max(.8,1.5-this.difficultyLevel*.1),this.showChallengeNotification()}showChallengeNotification(){const t=["¡Velocidad aumentada!","¡Dificultad extrema!","¡Modo infernal activado!","¡Velocidad máxima!","¡Desafío épico!"],e=Math.min(this.difficultyLevel-1,t.length-1),h=t[e]||`Nivel ${this.difficultyLevel} alcanzado!`,i=document.getElementById("challengeNotification");i.textContent=h,i.style.display="block",setTimeout(()=>{i.style.display="none"},2e3)}startGame(){this.state="playing",this.score=0,this.pipes=[],this.pipeSpawnTimer=0,this.difficultyLevel=0,this.gravity=this.baseGravity,this.jumpForce=this.baseJumpForce,this.pipeSpeed=this.basePipeSpeed,this.pipeGap=this.basePipeGap,this.pipeSpawnInterval=1.5,this.bird.x=100,this.bird.y=250,this.bird.velocity=0,this.bird.rotation=0,this.input.reset(),this.input.setEnabled(!0),document.getElementById("startScreen").style.display="none",document.getElementById("gameOverScreen").style.display="none",document.getElementById("challengeNotification").style.display="none",this.updateScoreDisplay()}gameOver(){this.state!=="gameover"&&(this.state="gameover",this.input.setEnabled(!1),this.score>this.highScore&&(this.highScore=this.score,u(this.highScore),this.updateHighScoreDisplay()),document.getElementById("finalScore").textContent=`Puntuación: ${this.score}`,document.getElementById("gameOverScreen").style.display="flex")}render(){this.renderer.clear(),this.renderer.drawBackground(),(this.state==="playing"||this.state==="gameover")&&(this.renderer.drawPipes(this.pipes),this.renderer.drawBird(this.bird))}updateScoreDisplay(){document.getElementById("score").textContent=this.score}updateHighScoreDisplay(){document.getElementById("highScore").textContent=`Récord: ${this.highScore}`}}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js",{scope:"./"}).then(s=>{console.log("Service Worker registrado:",s)}).catch(s=>{console.error("Error registrando Service Worker:",s)})});document.addEventListener("DOMContentLoaded",()=>{new f});
